<!doctype html><html lang=en dir=auto data-theme=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=8322&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Top level domains and punycode with C# | Bruno Garcia</title><meta name=keywords content="C#,Network"><meta name=description content="Working with internationalized domain names (IDN) and Punycode encoding in C# for top-level domain validation."><meta name=author content="Bruno Garcia"><link rel=canonical href=http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:8322/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:8322/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:8322/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:8322/apple-touch-icon.png><link rel=mask-icon href=http://localhost:8322/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><link href=http://localhost:8322/css/custom.min.94d61a4faa677b041a8c9b05ce33e529d1a58a009e5c79583e31ec6b7e2cd50b.css integrity="sha256-lNYaT6pnewQajJsFzjPlKdGligCeXHlYPjHsa34s1Qs=" rel="preload stylesheet" as=style><script src=https://browser.sentry-cdn.com/10.39.0/bundle.tracing.min.js crossorigin=anonymous></script><script>Sentry.init({dsn:"https://88e8d79d263e44f0b6e3c3745244ce9c@o117736.ingest.sentry.io/5778766",integrations:[Sentry.browserTracingIntegration()],tracesSampleRate:1})</script><meta property="og:url" content="http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/"><meta property="og:site_name" content="Bruno Garcia"><meta property="og:title" content="Top level domains and punycode with C#"><meta property="og:description" content="Working with internationalized domain names (IDN) and Punycode encoding in C# for top-level domain validation."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-11-10T23:37:00+01:00"><meta property="article:modified_time" content="2012-11-10T23:37:00+01:00"><meta property="article:tag" content="C#"><meta property="article:tag" content="Network"><meta property="og:image" content="http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/punycode.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/punycode.png"><meta name=twitter:title content="Top level domains and punycode with C#"><meta name=twitter:description content="Working with internationalized domain names (IDN) and Punycode encoding in C# for top-level domain validation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:8322/posts/"},{"@type":"ListItem","position":2,"name":"Top level domains and punycode with C#","item":"http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Top level domains and punycode with C#","name":"Top level domains and punycode with C#","description":"Working with internationalized domain names (IDN) and Punycode encoding in C# for top-level domain validation.","keywords":["C#","Network"],"articleBody":"Punycode is used to encode Unicode characters into ASCII for IDN (Internationalized domain name).\nOn the RFC 3492 you’ll find:\n“Punycode is a simple and efficient transfer encoding syntax designed for use with Internationalized Domain Names in Applications (IDNA). It uniquely and reversibly transforms a Unicode string into an ASCII string.”\nNow if you are looking for validating TLD (Top level domains), you must have that information in mind. The ICANN list of TLD also contains the IDN ccTLD that started to be included in 2010.\nSome Punycode encoded examples from that list:\nXN--0ZWM56D XN--11B5BS3A9AJ6G XN--3E0B707E XN--45BRJ9C XN--80AKHBYKNJ4F XN--80AO21A XN--90A3AC XN--9T4B11YI5A XN--CLCHC0EA0B2G2A9GCD XN--DEBA0AD XN--FIQS8S XN--FIQZ9S The prefix XN-- makes it easier to identify the Punycode encoded strings.\nLuckily since version 2.0, the .Net Framework offers a class to deal with IDN (Punycode and the Nameprep it has to do prior to encoding):\nSystem.Globalization.IdnMapping\nMy goal was to receive a TLD (string) and validate it against the ICANN list of TLD. My first snippet threw an exception on line 4:\nvar tld = \".ਭਾਰਤ\"; if (Regex.IsMatch(tld, @\"[^\\u0000-\\u007F]\")) { tld = _IdnMapping.GetAscii(tld); } Exception message was: IDN labels must be between 1 and 63 characters long.\nMy speed reading techniques are quite bad.. In fact I don’t have any. Sometimes I just focus on what I believe to be the most important part of the message (in this case “1 and 63 chars long” which didn’t make sense) and I ended up missing something important (IDN labels).\nI googled the exception, finding only these very useful (?!?) Exception translation websites and nothing more.\nOnly to better read the message and realize that the catch was that IdnMapping works with domain name labels:\n“A constituent part of a domain name. The labels of domain names are connected by dots. For example, “www.iana.org” contains three labels — “www”, “iana” and “org”. For internationalized domain names, the labels may be referred to as A-labels and U-labels.”\nTherefore, my input was simply broken considering it started with a dot. If you are looking to validate the complete list of TLD, including ccTLD, or even the complete domain with multiple labels supporting IDN, the IdnMapping class is a go. However, make sure your code does not have leading or trailing dots by having it Trim('.') or something.\nRegarding the IDNA versions, on the .Net framework prior to version 4.5 works with version 2003. Now if you are running .Net Framework 4.5 on Windows 8, the IDNA 2008 will be used.\n","wordCount":"413","inLanguage":"en","image":"http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/punycode.png","datePublished":"2012-11-10T23:37:00+01:00","dateModified":"2012-11-10T23:37:00+01:00","author":{"@type":"Person","name":"Bruno Garcia"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/"},"publisher":{"@type":"Person","name":"Bruno Garcia","logo":{"@type":"ImageObject","url":"http://localhost:8322/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=http://localhost:8322/ accesskey=h title="Bruno Garcia (Alt + H)">Bruno Garcia</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:8322/projects/ title=Projects><span>Projects</span></a></li><li><a href=http://localhost:8322/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Top level domains and punycode with C#</h1><div class=post-description>Working with internationalized domain names (IDN) and Punycode encoding in C# for top-level domain validation.</div><div class=post-meta><span title='2012-11-10 23:37:00 +0100 +0100'>November 10, 2012</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>Bruno Garcia</span></div></header><figure class="entry-cover cover-small"><img loading=eager srcset='http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/punycode.png 312w' src=http://localhost:8322/posts/2012/top-level-domains-and-punycode-with-c/punycode.png sizes="(min-width: 768px) 720px, 100vw" width=312 height=83 alt></figure><div class=post-content><p><a href=http://en.wikipedia.org/wiki/Punycode>Punycode</a> is used to encode Unicode characters into ASCII for <a href=http://en.wikipedia.org/wiki/Internationalized_domain_name>IDN (Internationalized domain name)</a>.</p><p>On the <a href=http://www.ietf.org/rfc/rfc3492.txt>RFC 3492</a> you&rsquo;ll find:</p><blockquote><p><em>&ldquo;Punycode is a simple and efficient transfer encoding syntax designed for use with Internationalized Domain Names in Applications (IDNA). It uniquely and reversibly transforms a Unicode string into an ASCII string.&rdquo;</em></p></blockquote><p>Now if you are looking for validating TLD (Top level domains), you must have that information in mind. The <a href=http://data.iana.org/TLD/tlds-alpha-by-domain.txt>ICANN list of TLD</a> also contains the IDN ccTLD that started to be included in 2010.</p><p>Some Punycode encoded examples from that list:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-fallback data-lang=fallback><span style=display:flex><span>XN--0ZWM56D
</span></span><span style=display:flex><span>XN--11B5BS3A9AJ6G
</span></span><span style=display:flex><span>XN--3E0B707E
</span></span><span style=display:flex><span>XN--45BRJ9C
</span></span><span style=display:flex><span>XN--80AKHBYKNJ4F
</span></span><span style=display:flex><span>XN--80AO21A
</span></span><span style=display:flex><span>XN--90A3AC
</span></span><span style=display:flex><span>XN--9T4B11YI5A
</span></span><span style=display:flex><span>XN--CLCHC0EA0B2G2A9GCD
</span></span><span style=display:flex><span>XN--DEBA0AD
</span></span><span style=display:flex><span>XN--FIQS8S
</span></span><span style=display:flex><span>XN--FIQZ9S
</span></span></code></pre></div><p>The prefix <code>XN--</code> makes it easier to identify the Punycode encoded strings.</p><p>Luckily since version 2.0, the .Net Framework offers a class to deal with IDN (Punycode and the Nameprep it has to do prior to encoding):</p><p><code>System.Globalization.IdnMapping</code></p><p>My goal was to receive a TLD (string) and validate it against the ICANN list of TLD. My first snippet threw an exception on line 4:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#8be9fd>var</span> tld = <span style=color:#f1fa8c>&#34;.ਭਾਰਤ&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> (Regex.IsMatch(tld, <span style=color:#f1fa8c>@&#34;[^\u0000-\u007F]&#34;</span>))
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    tld = _IdnMapping.GetAscii(tld);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Exception message was: <strong>IDN labels must be between 1 and 63 characters long.</strong></p><p>My speed reading techniques are quite bad.. In fact I don&rsquo;t have any. Sometimes I just focus on what I believe to be the most important part of the message (in this case &ldquo;1 and 63 chars long&rdquo; which didn&rsquo;t make sense) and I ended up missing something important (<strong>IDN labels</strong>).</p><p>I googled the exception, finding only these very useful (?!?) <a href=https://web.archive.org/web/2014/http://www.errortoenglish.com/pt-pt/W4Y3A1Y5/IDN-labels-must-be-between-1-and-63-characters-long.aspx>Exception translation websites</a> and nothing more.</p><p>Only to better read the message and realize that the catch was that <code>IdnMapping</code> works with <a href=https://www.icann.org/en/icann-acronyms-and-terms>domain name labels</a>:</p><blockquote><p><em>&ldquo;A constituent part of a domain name. The labels of domain names are connected by dots. For example, &ldquo;<a href=https://www.iana.org>www.iana.org</a>&rdquo; contains three labels — &ldquo;www&rdquo;, &ldquo;iana&rdquo; and &ldquo;org&rdquo;. For internationalized domain names, the labels may be referred to as A-labels and U-labels.&rdquo;</em></p></blockquote><p>Therefore, my input was simply broken considering it started with a dot. If you are looking to validate the complete list of TLD, including ccTLD, or even the complete domain with multiple labels supporting IDN, the <code>IdnMapping</code> class is a go. However, make sure your code does not have leading or trailing dots by having it <code>Trim('.')</code> or something.</p><p><img alt=Punycode loading=lazy src=/posts/2012/top-level-domains-and-punycode-with-c/punycode.png></p><p>Regarding the IDNA versions, on the .Net framework prior to version 4.5 works with version 2003. Now if you are running <a href=http://msdn.microsoft.com/en-us/library/system.globalization.idnmapping.aspx>.Net Framework 4.5 on Windows 8, the IDNA 2008</a> will be used.</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:8322/tags/c%23/>C#</a></li><li><a href=http://localhost:8322/tags/network/>Network</a></li></ul></footer></article></main><footer class=footer><div class=footer-projects>hobby projects:
<a href=https://codereviewtrends.com target=_blank rel=noopener>Code Review Trends</a>
·
<a href=https://nugettrends.com target=_blank rel=noopener>NuGet Trends</a></div><span>&copy; 2026 <a href=https://github.com/bruno-garcia/blog target=_blank rel=noopener>Bruno Garcia</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>